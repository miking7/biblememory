# Bible Memory App - Modern PWA

A modern, offline-first Bible memory application built with Vue 3 and TypeScript. Features spaced repetition for effective scripture memorization, beautiful UI with glass-morphism design, and robust multi-device sync.

## âœ¨ Features

- **Verse Management**: Add, edit, delete, search, and organize scripture verses
- **Spaced Repetition**: Proven algorithm with auto-categorization (learn/daily/weekly/monthly)
- **Review System**: Basic mode (reference â†’ content reveal) with progress tracking
- **Offline-First**: Full functionality without internet via IndexedDB
- **Multi-Device Sync**: OpLog pattern with cursor-based pagination and conflict resolution
- **Authentication**: Secure token-based auth with data migration on signup
- **Import/Export**: JSON format with smart ID handling
- **Tags System**: Structured key-value organization
- **Modern UI**: Glass-morphism design, responsive layout, smooth animations
- **Advanced Features**: Flash Cards, Hints, and more via integrated legacy app

## ğŸš€ Technology Stack

**Frontend:** Vue.js 3, TypeScript, Tailwind CSS v4, Dexie.js, Vite 5
**Backend:** PHP 8.0+, SQLite, OpLog sync pattern
**Architecture:** Offline-first SPA with token-based authentication

See [techContext.md](memory-bank/techContext.md) for detailed stack information.

## ğŸ“ Project Structure

```
biblememory/
â”œâ”€â”€ client/                     # Vue 3 frontend (TypeScript + Vite)
â”‚   â”œâ”€â”€ src/                   # Source code (main.ts, app.ts, db.ts, actions.ts, sync.ts)
â”‚   â””â”€â”€ ...                    # Config files (vite.config.ts, tsconfig.json)
â”‚
â”œâ”€â”€ server/                     # PHP backend
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â”œâ”€â”€ dist/              # Built assets (generated by Vite)
â”‚   â”‚   â”‚   â””â”€â”€ legacy/        # Legacy app with advanced features
â”‚   â”‚   â””â”€â”€ ...                # Router files (index.php, router.php)
â”‚   â”œâ”€â”€ api/                   # API endpoints (register, login, push, pull, migrate)
â”‚   â””â”€â”€ schema.sql             # Database schema
â”‚
â””â”€â”€ memory-bank/               # ğŸ“š Complete project documentation
    â”œâ”€â”€ projectbrief.md        # Project foundation and goals
    â”œâ”€â”€ productContext.md      # User experience and features
    â”œâ”€â”€ systemPatterns.md      # Architecture and design patterns
    â”œâ”€â”€ techContext.md         # Technology stack and setup
    â”œâ”€â”€ activeContext.md       # Current work and decisions
    â”œâ”€â”€ progress.md            # Roadmap and feature status
    â””â”€â”€ previous-work/         # Archived work sessions
```

## ğŸ› ï¸ Setup Instructions

### Prerequisites
- **Node.js 18+** (for client development)
- **PHP 8.0+** (for server)
- **SQLite3** extension enabled in PHP
- **Laravel Herd** (recommended) or PHP built-in server

### Quick Start

1. **Clone the repository**
```bash
git clone <repository-url>
cd biblememory
```

2. **Install client dependencies**
```bash
npm run install:client
```

3. **Set up the database**
```bash
npm run migrate
```

4. **Build the client** (for production)
```bash
npm run build
```
Note: This automatically runs `npm install` before building to ensure dependencies are up-to-date.

5. **Serve the app**

**Option A: Laravel Herd (Recommended)**
- Herd automatically serves `server/public` at `https://biblememory.test`
- No additional setup needed!
- Visit `https://biblememory.test`

**Option B: PHP Built-in Server**
```bash
cd server/public
php -S localhost:8000 router.php
```
- Visit `http://localhost:8000`

### Development Mode

For frontend development with hot reload:

```bash
npm run dev
```

This starts Vite dev server at `http://localhost:3000` with hot module replacement.

**With Laravel Herd:**
- Vite proxies API calls to `https://biblememory.test/api/*`
- Visit `http://localhost:3000` for development

**With PHP Built-in Server:**
- Update `client/vite.config.ts` proxy target to `http://localhost:8000`
- Start PHP server: `cd server/public && php -S localhost:8000 router.php`
- Visit `http://localhost:3000` for development

**Note:** All npm commands can now be run from the project root!

See [techContext.md](memory-bank/techContext.md) for detailed setup instructions, deployment configurations, and development workflows.

## ğŸ’¡ Usage

### Adding Verses

1. Click the **"ğŸ“ Add Verse"** tab
2. Fill in the form:
   - **Reference**: e.g., "John 3:16"
   - **Reference Sort**: e.g., "bible.43003016" (format: bible.BBCCCVVV)
     - BB = book number (01-66)
     - CCC = chapter (001-999)
     - VVV = verse (001-999)
   - **Verse Text**: The verse content (supports multi-paragraph with line breaks)
   - **Translation**: e.g., "NIV", "ESV", "KJV" (optional)
   - **Tags**: Comma-separated, e.g., "fast.sk=3, ss=2010.Q2.W01, personal" (optional)
3. Click **"Add Verse"**

### Reviewing Verses

1. Click the **"ğŸ¯ Review"** tab
2. You'll see verses due for review based on spaced repetition
3. Click **"Reveal Verse"** to see the content
4. Mark as **"âœ“ Got it!"** or **"Need Practice"**

### Managing Verses

1. Click the **"ğŸ“š My Verses"** tab
2. Use the search box to filter verses
3. Click **"Edit"** to modify a verse
4. Click **"Delete"** to remove a verse
5. Click **"Export"** to download all verses as JSON
6. Click **"Import"** to upload verses from JSON

### Spaced Repetition Schedule

The app uses a proven spaced repetition algorithm:

- **Learn** (first 7 days): Daily review
- **Daily** (days 8-56): Daily review
- **Weekly** (days 57-112): 1-in-7 probability
- **Monthly** (after day 112): 1-in-30 probability

## ğŸ”Œ API Endpoints

### Authentication

```http
POST /api/register.php
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123"
}

Response: {
  "user_id": "uuid",
  "token": "64-char-hex"
}
```

```http
POST /api/login.php
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123"
}

Response: {
  "user_id": "uuid",
  "token": "64-char-hex"
}
```

```http
POST /api/logout.php
X-Auth-Token: your-token-here

Response: {
  "ok": true
}
```

### Sync

```http
POST /api/push.php
X-Auth-Token: your-token-here
Content-Type: application/json

{
  "client_id": "device-id",
  "ops": [
    {
      "id": "op-uuid",
      "table": "verses",
      "row_id": "verse-uuid",
      "op_type": "insert",
      "data": { ... },
      "ts": 1234567890
    }
  ]
}

Response: {
  "ok": true,
  "acked_ids": ["op-uuid"],
  "cursor": 123
}
```

```http
GET /api/pull.php?since=0&limit=500
X-Auth-Token: your-token-here

Response: {
  "cursor": 123,
  "ops": [...]
}
```

## ğŸ“Š Data Model

### Verse
```typescript
{
  id: string              // UUID v4
  reference: string       // "John 3:16"
  refSort: string         // "bible.43003016"
  content: string         // Verse text with \n for line breaks
  translation: string     // "NIV", "ESV", "KJV"
  reviewCat: string       // "auto", "future", "learn", "daily", "weekly", "monthly"
  startedAt: number|null  // Epoch ms
  tags: Array<{key, value}>
  favorite: boolean
  createdAt: number       // Epoch ms
  updatedAt: number       // Epoch ms
}
```

### Review
```typescript
{
  id: string              // UUID v4
  verseId: string         // Foreign key
  reviewType: string      // "recall", "practice"
  createdAt: number       // Epoch ms
}
```

## ğŸ¨ UI Features

### Design System
- **Color Scheme**: Deep blue/purple gradients
- **Typography**: Inter font family
- **Components**: Glass-morphism cards with backdrop blur
- **Animations**: Smooth transitions and hover effects
- **Responsive**: Mobile-first design with Tailwind breakpoints

### Key UI Elements
- Gradient background (blue â†’ purple â†’ slate)
- Frosted glass cards with blur effects
- Rounded corners and shadows
- Color-coded stats cards
- Smooth hover animations
- Badge notifications for due reviews
- Modal dialogs for editing

## ğŸ§ª Development

### Available Commands (Root Level)

All commands can now be run from the project root:

```bash
# Frontend Development
npm run dev              # Start Vite dev server with HMR (port 3000)
npm run build            # Install deps + build for production
npm run preview          # Preview production build
npm run install:client   # Install client dependencies only

# Database Management
npm run migrate          # Setup database (creates tables)
npm run db:reset         # Delete database and recreate
npm run db:open          # Open SQLite CLI

# Note: No server command needed if using Laravel Herd
# Herd automatically serves server/public at https://biblememory.test
```

See [techContext.md](memory-bank/techContext.md) for additional development workflows, code style guidelines, and testing procedures.

## ğŸ› Troubleshooting

### Client Issues

**Problem**: `npm install` fails
**Solution**: Ensure Node.js 18+ is installed, try `npm cache clean --force`

**Problem**: Build fails with TypeScript errors
**Solution**: Run `npm install` to ensure all dependencies are installed

**Problem**: Styles not loading
**Solution**: Ensure Tailwind CSS v4 is installed, rebuild with `npm run build`

**Problem**: App doesn't load in browser
**Solution**: Check browser console for errors, ensure dev server is running

### Server Issues

**Problem**: Database errors
**Solution**: Delete `api/db.sqlite` and run `php api/migrate.php` again

**Problem**: Authentication fails
**Solution**: 
- Check that token is being sent in `X-Auth-Token` header
- Verify token in database `users` table
- Try logging in again to get a fresh token

**Problem**: CORS errors
**Solution**: Ensure `handle_cors()` is called in all API endpoints

**Problem**: 404 errors for assets
**Solution**: 
- Verify build completed successfully
- Check that `server/public/dist/` directory exists
- Ensure `router.php` is being used with PHP built-in server

**Problem**: PHP errors about SQLite
**Solution**: Ensure SQLite3 extension is enabled in `php.ini`

## ğŸš€ Roadmap

### Phase 2: Enhanced Review Modes

- Flash Cards mode (5 difficulty levels: 0%, 10%, 25%, 45%, 100%)
- First Letters mode (first letter + punctuation)
- Progressive Hints mode (incremental word reveal)
- Keyboard shortcuts (n/p/h/f/Space)
- Quick jump from verse list to review

### Phase 3: Deep Engagement

- Meditation questions (structured reflection prompts)
- Application questions (4 life areas: Goals, Decisions, Lifestyle, Problems)
- BibleGateway chapter lookup integration
- Human-readable time display

### Phase 4: Modern Enhancements

- Statistics dashboard with charts
- Dark mode, PWA installation
- Streak tracking with achievements
- Background sync and notifications

See [progress.md](memory-bank/progress.md) for complete roadmap and feature parity status.

## ğŸ“„ License

Private project - All rights reserved

## ğŸ“š Documentation

For detailed project documentation, see the [memory-bank/](memory-bank/) directory:

- [projectbrief.md](memory-bank/projectbrief.md) - Project foundation and goals
- [productContext.md](memory-bank/productContext.md) - User experience and features
- [systemPatterns.md](memory-bank/systemPatterns.md) - Architecture and design patterns
- [techContext.md](memory-bank/techContext.md) - Technology stack and setup
- [progress.md](memory-bank/progress.md) - Roadmap and feature status
- [activeContext.md](memory-bank/activeContext.md) - Current work focus

---

**Last Updated**: January 2025
